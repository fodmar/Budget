@{
    Func<ModelMetadata, bool> shouldShow = metadata =>
    {
        return metadata.ShowForEdit
            && !metadata.IsComplexType
            && !ViewData.TemplateInfo.Visited(metadata);
    };
}

@if (ViewData.TemplateInfo.TemplateDepth > 1)
{
    if (Model == null)
    {
        @ViewData.ModelMetadata.NullDisplayText
    }
    else
    {
        @ViewData.ModelMetadata.SimpleDisplayText
    }
}
else
{
    foreach (var prop in ViewData.ModelMetadata.Properties.Where(shouldShow))
    {
        <div class="form-group">
            @if (prop.HideSurroundingHtml) // hidden inputs
            {
                @Html.Editor(prop.PropertyName)
            }
            else
            {
                @Html.Label(prop.PropertyName)
                @Html.Editor(prop.PropertyName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessage(prop.PropertyName)
            }
        </div>
    }
}